import email

fp = open("luan.eml", "r")
msg = email.message_from_file(fp)

# ?????????mime????
for par in msg.walk():
    if not par.is_multipart(): # ????????multipart,???,?????????,?????????mime?????
        name = par.get_param("name") #?????,????????????
        if name:
            #???
            # ??????????????=?gbk?Q?=CF=E0=C6=AC.rar?=??????
            h = email.Header.Header(name)
            dh = email.Header.decode_header(h)
            fname = dh[0][0]
            print '???:', fname
            data = par.get_payload(decode=True) # ???????,????????
            
            try:
                f = open(fname, 'wb') #??????wb?????,?????????????
            except:
                print '????????,?????'
                f = open('aaaa', 'wb')
            f.write(data)
            f.close()
        else:
            #????,?????
            print par.get_payload(decode=True) # ???????,??????????
        
        print '+'*60 # ???????????